---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import ShareButtons from '../../components/ShareButtons.astro';
import ImageLightbox from '../../components/ImageLightbox.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const { title, description, date, coverImage, tags } = post.data;

const formattedDate = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// Construct canonical URL
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
---

<Layout title={`${title} - Jonnykcode`} description={description}>
  <article class="max-w-3xl mx-auto py-10">
    <div class="mb-10 text-center">
        <div class="flex justify-center gap-2 mb-4">
            {tags.map((tag) => (
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200">
                    {tag}
                </span>
            ))}
        </div>
        <h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-4 leading-tight">
            {title}
        </h1>
        <time datetime={date.toISOString()} class="text-gray-500 dark:text-gray-400">
            {formattedDate}
        </time>
    </div>

    {coverImage && (
        <div class="mb-10 rounded-xl overflow-hidden shadow-lg">
             <img src={coverImage} alt={title} class="w-full h-auto object-cover" loading="eager" />
        </div>
    )}

    <div class="prose prose-lg dark:prose-invert mx-auto prose-a:text-primary-700 hover:prose-a:text-primary-800 dark:prose-a:text-primary-400 dark:hover:prose-a:text-primary-300 prose-img:rounded-xl prose-img:shadow-lg max-w-none">
        <Content />
    </div>

    <ShareButtons url={canonicalURL} title={title} description={description} />
  </article>

  <ImageLightbox />
</Layout>
