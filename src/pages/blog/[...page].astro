---
import Layout from "../../layouts/Layout.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths({ paginate }: { paginate: any }) {
  const posts = (await getCollection("posts")).sort(
    (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
  );

  return paginate(posts, { pageSize: 6 });
}

interface Props {
  page: {
    data: CollectionEntry<"posts">[];
    url: {
      prev: string | undefined;
      next: string | undefined;
    };
    currentPage: number;
    lastPage: number;
  };
}

const { page } = Astro.props;
---

<Layout
  title="Blog - Jonnykcode"
  description="Read my latest thoughts and research on technology."
>
  <section class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="border-b-[8px] border-black dark:border-white pb-8 mb-16">
      <h1
        class="text-6xl md:text-9xl font-black uppercase tracking-tightest leading-none font-serif italic"
      >
        The<br />Archive
      </h1>
    </div>

    <div class="grid gap-12 md:grid-cols-2 lg:grid-cols-3">
      {page.data.map((post) => <PostCard post={post} />)}
    </div>

    <div
      class="mt-20 flex flex-col md:flex-row justify-between items-center gap-8 border-t-[4px] border-black dark:border-white pt-12"
    >
      {
        page.url.prev ? (
          <a
            href={page.url.prev}
            class="px-8 py-4 bg-white dark:bg-black border-4 border-black dark:border-white font-black uppercase tracking-widest hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all brutalist-border mono"
          >
            <span aria-hidden="true">&larr;</span> Previous Page
          </a>
        ) : (
          <div class="hidden md:block" />
        )
      }

      <span
        class="text-xl font-black uppercase mono"
        aria-label={`Current page: ${page.currentPage} of ${page.lastPage}`}
        role="status"
      >
        {page.currentPage} / {page.lastPage}
      </span>

      {
        page.url.next ? (
          <a
            href={page.url.next}
            class="px-8 py-4 bg-white dark:bg-black border-4 border-black dark:border-white font-black uppercase tracking-widest hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all brutalist-border mono"
          >
            Next Page <span aria-hidden="true">&rarr;</span>
          </a>
        ) : (
          <div class="hidden md:block" />
        )
      }
    </div>
  </section>
</Layout>

<style>
  .tracking-tightest {
    letter-spacing: -0.05em;
  }
</style>
